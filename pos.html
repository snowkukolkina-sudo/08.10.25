<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DANDY POS - –ö–∞—Å—Å–∞</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root {
            --dandy-green: #0b5c3b;
            --dandy-yellow: #ffd24d;
            --dandy-pink: #ff69b4;
        }
        
        .status-online { color: #10b981; }
        .status-offline { color: #ef4444; }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 16px;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            z-index: 1000;
            max-width: 400px;
        }
        
        .notification-success { border-left: 4px solid #10b981; }
        .notification-warning { border-left: 4px solid #f59e0b; }
        .notification-error { border-left: 4px solid #ef4444; }
        .notification-info { border-left: 4px solid #3b82f6; }
        
        .notification-title {
            font-weight: 600;
            margin-bottom: 4px;
        }
        
        .notification-message {
            color: #6b7280;
            font-size: 14px;
        }
        
        /* –£–ª—É—á—à–µ–Ω–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫ –æ–ø–ª–∞—Ç—ã */
        .payment-btn {
            display: flex;
            align-items: center;
            gap: 16px;
            padding: 20px 24px;
            border: 2px solid #e5e7eb;
            border-radius: 20px;
            background: white;
            transition: all 0.3s ease;
            cursor: pointer;
            text-align: left;
            width: 100%;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            position: relative;
            overflow: hidden;
        }
        
        .payment-btn:hover:not(:disabled) {
            transform: translateY(-4px);
            box-shadow: 0 12px 35px rgba(0, 0, 0, 0.15);
            border-color: #10b981;
        }
        
        .payment-btn:active:not(:disabled) {
            transform: translateY(-2px);
        }
        
        .payment-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }
        
        .payment-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s ease;
        }
        
        .payment-btn:hover:not(:disabled)::before {
            left: 100%;
        }
        
        .payment-icon {
            font-size: 28px;
            width: 48px;
            height: 48px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #f3f4f6, #e5e7eb);
            border-radius: 16px;
            flex-shrink: 0;
            transition: all 0.3s ease;
        }
        
        .payment-content {
            flex: 1;
        }
        
        .payment-title {
            font-weight: 700;
            font-size: 18px;
            color: #1f2937;
            margin-bottom: 4px;
        }
        
        .payment-subtitle {
            font-size: 14px;
            color: #6b7280;
            font-weight: 500;
        }
        
        /* –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ –æ–ø–ª–∞—Ç—ã */
        .cash-btn:hover:not(:disabled) {
            border-color: #f59e0b;
            background: linear-gradient(135deg, #fef3c7, #fde68a);
        }
        
        .cash-btn:hover:not(:disabled) .payment-icon {
            background: linear-gradient(135deg, #f59e0b, #d97706);
            color: white;
            transform: scale(1.1);
        }
        
        .acq-btn:hover:not(:disabled) {
            border-color: #3b82f6;
            background: linear-gradient(135deg, #dbeafe, #bfdbfe);
        }
        
        .acq-btn:hover:not(:disabled) .payment-icon {
            background: linear-gradient(135deg, #3b82f6, #2563eb);
            color: white;
            transform: scale(1.1);
        }
        
        .sbp-btn:hover:not(:disabled) {
            border-color: #8b5cf6;
            background: linear-gradient(135deg, #ede9fe, #ddd6fe);
        }
        
        .sbp-btn:hover:not(:disabled) .payment-icon {
            background: linear-gradient(135deg, #8b5cf6, #7c3aed);
            color: white;
            transform: scale(1.1);
        }
        
        /* –ê–Ω–∏–º–∞—Ü–∏—è –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ */
        .payment-btn:hover:not(:disabled) .payment-icon {
            transform: scale(1.1);
        }
        
        /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤ */
        @media (max-width: 768px) {
            .payment-btn {
                padding: 14px 16px;
                gap: 10px;
            }
            
            .payment-icon {
                font-size: 20px;
                width: 36px;
                height: 36px;
            }
            
            .payment-title {
                font-size: 15px;
            }
            
            .payment-subtitle {
                font-size: 12px;
            }
        }
    </style>
</head>
<body class="min-h-screen bg-gray-50">
    <!-- Header -->
    <div class="sticky top-0 z-20 bg-pink-500/90 backdrop-blur border-b border-pink-300">
        <div class="max-w-7xl mx-auto px-3 py-1 flex items-center gap-2 text-white">
            <div class="text-base sm:text-lg font-bold tracking-wide">DANDY POS</div>
            <input
                id="searchInput"
                placeholder="–ü–æ–∏—Å–∫ –ø–æ –ø–æ–∑–∏—Ü–∏—è–º‚Ä¶"
                class="flex-1 rounded-lg border border-pink-300/60 bg-white/95 text-gray-900 px-3 py-1 outline-none focus:ring focus:ring-pink-300"
            />
            <div class="flex items-center gap-2">
                <span id="network-icon" class="text-lg">üü¢</span>
                <span id="network-status" class="status-online text-sm">–û–Ω–ª–∞–π–Ω</span>
            </div>
            <button id="authBtn" class="px-3 py-1 rounded-lg border border-white/60 hover:bg-white/10">
                –í—Ö–æ–¥
            </button>
            <button id="settingsBtn" class="px-3 py-1 rounded-lg border border-white/60 hover:bg-white/10">
                –ù–∞—Å—Ç—Ä–æ–π–∫–∏
            </button>
            <button id="backToAdmin" class="px-3 py-1 rounded-lg border border-white/60 hover:bg-white/10">
                ‚Üê –ê–¥–º–∏–Ω–∫–∞
            </button>
        </div>
    </div>

    <div class="max-w-7xl mx-auto p-2 md:p-3 grid grid-cols-12 gap-2">
        <!-- –õ–µ–≤–∞—è —á–∞—Å—Ç—å: –∫–∞–Ω–∞–ª + –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ + —Ç–æ–≤–∞—Ä—ã -->
        <div class="col-span-12 lg:col-span-8 space-y-2">
            <!-- –ö–∞–Ω–∞–ª –∑–∞–∫–∞–∑–∞ -->
            <div class="rounded-2xl border p-3 bg-white">
                <div class="mb-2 text-sm text-gray-600">–ö–∞–Ω–∞–ª –∑–∞–∫–∞–∑–∞</div>
                <div id="channelSelector" class="flex flex-wrap gap-1">
                    <!-- –ö–∞–Ω–∞–ª—ã –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã —á–µ—Ä–µ–∑ JS -->
                </div>
            </div>

            <!-- –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ -->
            <div class="rounded-2xl border p-3 bg-white">
                <div id="categoryTiles" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-1">
                    <!-- –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã —á–µ—Ä–µ–∑ JS -->
                </div>
            </div>

            <!-- –¢–æ–≤–∞—Ä—ã -->
            <div class="rounded-2xl border p-2 bg-white">
                <div id="productGrid" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-1">
                    <!-- –¢–æ–≤–∞—Ä—ã –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã —á–µ—Ä–µ–∑ JS -->
                </div>
            </div>

            <!-- KDS –æ—á–µ—Ä–µ–¥–∏ -->
            <div class="rounded-2xl border p-3 bg-white">
                <div class="font-semibold mb-2">KDS ‚Äî –æ—á–µ—Ä–µ–¥–∏ –ø—Ä–∏–Ω—Ç–µ—Ä–æ–≤ (—ç–º—É–ª—è—Ü–∏—è)</div>
                <div id="kdsQueues" class="grid grid-cols-1 md:grid-cols-3 gap-2">
                    <!-- –û—á–µ—Ä–µ–¥–∏ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã —á–µ—Ä–µ–∑ JS -->
                </div>
            </div>

            <!-- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞–º–∏ -->
            <div class="rounded-2xl border p-3 bg-white">
                <div class="flex items-center justify-between mb-3">
                    <div class="font-semibold">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞–º–∏</div>
                    <button onclick="loadOrders()" class="px-3 py-1 bg-blue-500 text-white rounded-lg hover:bg-blue-600 text-sm">
                        üîÑ –û–±–Ω–æ–≤–∏—Ç—å
                    </button>
                </div>
                
                <!-- –§–∏–ª—å—Ç—Ä—ã —Å—Ç–∞—Ç—É—Å–æ–≤ -->
                <div class="flex flex-wrap gap-1 mb-3">
                    <button onclick="filterOrders('all')" class="px-2 py-1 rounded-full border text-xs bg-gray-100 text-gray-700 border-gray-300 hover:bg-gray-200">
                        –í—Å–µ
                    </button>
                    <button onclick="filterOrders('accepted')" class="px-2 py-1 rounded-full border text-xs bg-yellow-100 text-yellow-700 border-yellow-300 hover:bg-yellow-200">
                        –ü—Ä–∏–Ω—è—Ç—ã
                    </button>
                    <button onclick="filterOrders('preparing')" class="px-2 py-1 rounded-full border text-xs bg-orange-100 text-orange-700 border-orange-300 hover:bg-orange-200">
                        –ì–æ—Ç–æ–≤—è—Ç—Å—è
                    </button>
                    <button onclick="filterOrders('ready')" class="px-2 py-1 rounded-full border text-xs bg-green-100 text-green-700 border-green-300 hover:bg-green-200">
                        –ì–æ—Ç–æ–≤—ã
                    </button>
                    <button onclick="filterOrders('delivered')" class="px-2 py-1 rounded-full border text-xs bg-blue-100 text-blue-700 border-blue-300 hover:bg-blue-200">
                        –î–æ—Å—Ç–∞–≤–ª–µ–Ω—ã
                    </button>
                </div>

                <!-- –°–ø–∏—Å–æ–∫ –∑–∞–∫–∞–∑–æ–≤ -->
                <div id="ordersList" class="space-y-2 max-h-96 overflow-y-auto">
                    <!-- –ó–∞–∫–∞–∑—ã –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã —á–µ—Ä–µ–∑ JS -->
                </div>
                
                <div id="noOrders" class="text-center text-gray-500 py-4 hidden">
                    –ù–µ—Ç –∑–∞–∫–∞–∑–æ–≤
                </div>
            </div>
        </div>

        <!-- –ü—Ä–∞–≤–∞—è —á–∞—Å—Ç—å: —á–µ–∫ + –æ–ø–ª–∞—Ç–∞ + —á–µ–∫–∏ -->
        <div class="col-span-12 lg:col-span-4 space-y-2">
            <!-- –ö–æ—Ä–∑–∏–Ω–∞ -->
            <div id="cart" class="rounded-2xl border shadow-sm p-3 flex flex-col h-full bg-white">
                <!-- –ö–æ—Ä–∑–∏–Ω–∞ –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–∞ —á–µ—Ä–µ–∑ JS -->
            </div>

            <!-- –ü–∞–Ω–µ–ª—å –æ–ø–ª–∞—Ç—ã -->
            <div id="paymentPanel" class="rounded-2xl border p-3 bg-white">
                <!-- –ü–∞–Ω–µ–ª—å –æ–ø–ª–∞—Ç—ã –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–∞ —á–µ—Ä–µ–∑ JS -->
            </div>

            <!-- –ñ—É—Ä–Ω–∞–ª —á–µ–∫–æ–≤ -->
            <div id="receiptsLog" class="rounded-2xl border p-3 bg-white">
                <!-- –ñ—É—Ä–Ω–∞–ª —á–µ–∫–æ–≤ –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω —á–µ—Ä–µ–∑ JS -->
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ -->
    <div id="modalOverlay" class="fixed inset-0 z-[100] flex items-center justify-center hidden">
        <div class="absolute inset-0 bg-black/40" onclick="closeModal()"></div>
        <div id="modalContent" class="relative w-full max-w-lg mx-4 rounded-2xl bg-white shadow-xl border">
            <!-- –°–æ–¥–µ—Ä–∂–∏–º–æ–µ –º–æ–¥–∞–ª–∫–∏ –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–æ —á–µ—Ä–µ–∑ JS -->
        </div>
    </div>

    <!-- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –≤—Å–µ—Ö –º–æ–¥—É–ª–µ–π -->
    <script src="demo-data.js"></script>
    <script src="modules/fiscal-module.js"></script>
    <script src="modules/acquiring-module.js"></script>
    <script src="modules/delivery-module.js"></script>
    <script src="modules/auth-module.js"></script>
    <script src="modules/offline-module.js"></script>
    <script src="modules/reports-module.js"></script>
    <script src="modules/erp-integration.js"></script>
    <!-- –ù–æ–≤—ã–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ –º–æ–¥—É–ª–∏ -->
    <script src="modules/real-kkm-module.js"></script>
    <script src="modules/real-acquiring-module.js"></script>
    <script src="modules/enhanced-offline-module.js"></script>
    <script src="modules/enhanced-modifiers-module.js"></script>
    <script src="modules/composite-products-module.js"></script>
    <script src="modules/aggregator-integrations.js"></script>
    <script src="modules/advanced-reporting-module.js"></script>
    <script src="modules/biometric-auth-module.js"></script>
    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –¥–µ—Ç–∞–ª–µ–π –∑–∞–∫–∞–∑–∞ -->
    <div id="orderDetailsModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-lg max-w-2xl w-full max-h-[90vh] overflow-y-auto">
                <div class="p-6">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-lg font-semibold">–î–µ—Ç–∞–ª–∏ –∑–∞–∫–∞–∑–∞</h3>
                        <button onclick="closeOrderDetails()" class="text-gray-500 hover:text-gray-700">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                            </svg>
                        </button>
                    </div>
                    
                    <div id="orderDetailsContent">
                        <!-- –°–æ–¥–µ—Ä–∂–∏–º–æ–µ –±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω–æ —á–µ—Ä–µ–∑ JS -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="pos.js"></script>
    
    <!-- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≤—Å–µ—Ö –º–æ–¥—É–ª–µ–π -->
    <script>
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≤—Å–µ—Ö –º–æ–¥—É–ª–µ–π
        let fiscalModule, acquiringModule, deliveryModule, authModule, offlineModule, reportsModule, erpModule;
        // –ù–æ–≤—ã–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ –º–æ–¥—É–ª–∏
        let realKKMModule, realAcquiringModule, enhancedOfflineModule, enhancedModifiersModule, compositeProductsModule;
        let aggregatorIntegrationsModule, advancedReportingModule, biometricAuthModule;
        
        document.addEventListener('DOMContentLoaded', function() {
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –¥–µ–º–æ-–¥–∞–Ω–Ω—ã—Ö
            if (window.DEMO_DATA) {
                window.DEMO_DATA.initialize();
            }
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –º–æ–¥—É–ª–µ–π
            try {
                console.log('–ù–∞—á–∏–Ω–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É –º–æ–¥—É–ª–µ–π...');
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –∫–ª–∞—Å—Å—ã –¥–æ—Å—Ç—É–ø–Ω—ã
                if (typeof FiscalModule === 'undefined') {
                    throw new Error('FiscalModule –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω');
                }
                if (typeof AcquiringModule === 'undefined') {
                    throw new Error('AcquiringModule –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω');
                }
                if (typeof DeliveryModule === 'undefined') {
                    throw new Error('DeliveryModule –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω');
                }
                if (typeof AuthModule === 'undefined') {
                    throw new Error('AuthModule –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω');
                }
                if (typeof OfflineModule === 'undefined') {
                    throw new Error('OfflineModule –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω');
                }
                if (typeof ReportsModule === 'undefined') {
                    throw new Error('ReportsModule –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω');
                }
                if (typeof ERPIntegrationModule === 'undefined') {
                    throw new Error('ERPIntegrationModule –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω');
                }
                
                fiscalModule = new FiscalModule();
                acquiringModule = new AcquiringModule();
                deliveryModule = new DeliveryModule();
                authModule = new AuthModule();
                offlineModule = new OfflineModule();
                reportsModule = new ReportsModule();
                erpModule = new ERPIntegrationModule();
                
                // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –Ω–æ–≤—ã—Ö —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã—Ö –º–æ–¥—É–ª–µ–π (—Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π)
                if (typeof RealKKMModule !== 'undefined') {
                    realKKMModule = new RealKKMModule();
                } else {
                    console.warn('RealKKMModule –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω');
                }
                
                if (typeof RealAcquiringModule !== 'undefined') {
                    realAcquiringModule = new RealAcquiringModule();
                } else {
                    console.warn('RealAcquiringModule –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω');
                }
                
                if (typeof EnhancedOfflineModule !== 'undefined') {
                    enhancedOfflineModule = new EnhancedOfflineModule();
                } else {
                    console.warn('EnhancedOfflineModule –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω');
                }
                
                if (typeof EnhancedModifiersModule !== 'undefined') {
                    enhancedModifiersModule = new EnhancedModifiersModule();
                } else {
                    console.warn('EnhancedModifiersModule –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω');
                }
                
                if (typeof CompositeProductsModule !== 'undefined') {
                    compositeProductsModule = new CompositeProductsModule();
                } else {
                    console.warn('CompositeProductsModule –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω');
                }
                
                if (typeof AggregatorIntegrationsModule !== 'undefined') {
                    aggregatorIntegrationsModule = new AggregatorIntegrationsModule();
                } else {
                    console.warn('AggregatorIntegrationsModule –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω');
                }
                
                if (typeof AdvancedReportingModule !== 'undefined') {
                    advancedReportingModule = new AdvancedReportingModule();
                } else {
                    console.warn('AdvancedReportingModule –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω');
                }
                
                if (typeof BiometricAuthModule !== 'undefined') {
                    biometricAuthModule = new BiometricAuthModule();
                } else {
                    console.warn('BiometricAuthModule –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω');
                }
                
                console.log('–í—Å–µ –¥–æ—Å—Ç—É–ø–Ω—ã–µ –º–æ–¥—É–ª–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω—ã');
                
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ—Å—Å–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                console.log('–ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–µ—Å—Å–∏—é –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è...');
                if (authModule && authModule.checkSession()) {
                    console.log('–°–µ—Å—Å–∏—è –Ω–∞–π–¥–µ–Ω–∞, –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º POS –º–æ–¥—É–ª–∏...');
                    initializePOSModules();
                } else {
                    console.log('–°–µ—Å—Å–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –≤—Ö–æ–¥–∞...');
                    // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—Ö–æ–¥ —Å –¥–µ–º–æ-–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
                    autoLoginDemo();
                }
                
                // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–Ω–æ–ø–æ–∫
                document.getElementById('authBtn').addEventListener('click', showAuthModal);
                document.getElementById('settingsBtn').addEventListener('click', showSettingsModal);
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –º–æ–¥—É–ª–µ–π:', error);
                alert('–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ —Å–∏—Å—Ç–µ–º—ã. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞.');
            }
        });
        
        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—Ö–æ–¥ —Å –¥–µ–º–æ-–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º
        async function autoLoginDemo() {
            try {
                console.log('–ü—ã—Ç–∞–µ–º—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—Ö–æ–¥ —Å –¥–µ–º–æ-–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º...');
                
                // –°–Ω–∞—á–∞–ª–∞ —Å–±—Ä–∞—Å—ã–≤–∞–µ–º –ø–∞—Ä–æ–ª–∏, —á—Ç–æ–±—ã —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –æ–Ω–∏ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ
                console.log('–°–±—Ä–∞—Å—ã–≤–∞–µ–º –ø–∞—Ä–æ–ª–∏ –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏...');
                resetPasswords();
                
                // –ù–µ–±–æ–ª—å—à–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –¥–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Å–±—Ä–æ—Å–∞
                await new Promise(resolve => setTimeout(resolve, 100));
                
                const result = await authModule.authenticate('admin', 'admin123');
                if (result.success) {
                    console.log('–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—Ö–æ–¥ —É—Å–ø–µ—à–µ–Ω');
                    initializePOSModules();
                    updateAuthButton();
                } else {
                    console.log('–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—Ö–æ–¥ –Ω–µ —É–¥–∞–ª—Å—è, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ');
                    showAuthModal();
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –≤—Ö–æ–¥–∞:', error);
                showAuthModal();
            }
        }
        
        // –ü–æ–∫–∞–∑–∞—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
        function showAuthModal() {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-white rounded-lg p-6 w-96">
                    <h2 class="text-xl font-bold mb-4">–í—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É</h2>
                    <form id="authForm">
                        <div class="mb-4">
                            <label class="block text-sm font-medium mb-2">–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</label>
                            <input type="text" id="username" class="w-full border rounded-lg px-3 py-2" required>
                        </div>
                        <div class="mb-4">
                            <label class="block text-sm font-medium mb-2">–ü–∞—Ä–æ–ª—å</label>
                            <input type="password" id="password" class="w-full border rounded-lg px-3 py-2" required>
                        </div>
                        <div class="flex gap-2">
                            <button type="submit" class="flex-1 bg-pink-500 text-white py-2 rounded-lg hover:bg-pink-600">
                                –í–æ–π—Ç–∏
                            </button>
                            <button type="button" onclick="this.closest('.fixed').remove()" class="px-4 py-2 border rounded-lg">
                                –û—Ç–º–µ–Ω–∞
                            </button>
                        </div>
                    </form>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            document.getElementById('authForm').addEventListener('submit', async function(e) {
                e.preventDefault();
                const username = document.getElementById('username').value;
                const password = document.getElementById('password').value;
                
                const result = await authModule.authenticate(username, password);
                if (result.success) {
                    modal.remove();
                    initializePOSModules();
                    updateAuthButton();
                } else {
                    alert('–û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞: ' + result.error);
                }
            });
        }
        
        // –ü–æ–∫–∞–∑–∞—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –Ω–∞—Å—Ç—Ä–æ–µ–∫
        function showSettingsModal() {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-white rounded-lg p-6 w-96 max-h-96 overflow-y-auto">
                    <h2 class="text-xl font-bold mb-4">–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–∏—Å—Ç–µ–º—ã</h2>
                    <div class="space-y-4">
                        <div>
                            <h3 class="font-medium mb-2">–§–∏—Å–∫–∞–ª–∏–∑–∞—Ü–∏—è</h3>
                            <button onclick="configureFiscal()" class="w-full bg-green-500 text-white py-2 rounded-lg hover:bg-green-600 mb-2">
                                –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –§–ù (–±–∞–∑–æ–≤—ã–π)
                            </button>
                            <button onclick="configureRealKKM()" class="w-full bg-green-600 text-white py-2 rounded-lg hover:bg-green-700">
                                –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ö–ö–ú (—Ä–µ–∞–ª—å–Ω–∞—è)
                            </button>
                        </div>
                        <div>
                            <h3 class="font-medium mb-2">–≠–∫–≤–∞–π—Ä–∏–Ω–≥</h3>
                            <button onclick="configureAcquiring()" class="w-full bg-blue-500 text-white py-2 rounded-lg hover:bg-blue-600 mb-2">
                                –ù–∞—Å—Ç—Ä–æ–∏—Ç—å —Ç–µ—Ä–º–∏–Ω–∞–ª (–±–∞–∑–æ–≤—ã–π)
                            </button>
                            <button onclick="configureRealAcquiring()" class="w-full bg-blue-600 text-white py-2 rounded-lg hover:bg-blue-700">
                                –ù–∞—Å—Ç—Ä–æ–∏—Ç—å —ç–∫–≤–∞–π—Ä–∏–Ω–≥ (—Ä–µ–∞–ª—å–Ω—ã–π)
                            </button>
                        </div>
                        <div>
                            <h3 class="font-medium mb-2">–î–æ—Å—Ç–∞–≤–∫–∞</h3>
                            <button onclick="configureDelivery()" class="w-full bg-purple-500 text-white py-2 rounded-lg hover:bg-purple-600">
                                –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∑–æ–Ω—ã
                            </button>
                        </div>
                        <div>
                            <h3 class="font-medium mb-2">–†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏</h3>
                            <button onclick="configureModifiers()" class="w-full bg-orange-500 text-white py-2 rounded-lg hover:bg-orange-600 mb-2">
                                –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –º–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã
                            </button>
                            <button onclick="configureCompositeProducts()" class="w-full bg-indigo-500 text-white py-2 rounded-lg hover:bg-indigo-600 mb-2">
                                –ù–∞—Å—Ç—Ä–æ–∏—Ç—å —Å–æ—Å—Ç–∞–≤–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã
                            </button>
                            <button onclick="configureOfflineMode()" class="w-full bg-gray-500 text-white py-2 rounded-lg hover:bg-gray-600 mb-2">
                                –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –æ—Ñ–ª–∞–π–Ω-—Ä–µ–∂–∏–º
                            </button>
                            <button onclick="configureAggregators()" class="w-full bg-purple-500 text-white py-2 rounded-lg hover:bg-purple-600 mb-2">
                                –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∞–≥—Ä–µ–≥–∞—Ç–æ—Ä—ã
                            </button>
                            <button onclick="configureReporting()" class="w-full bg-teal-500 text-white py-2 rounded-lg hover:bg-teal-600 mb-2">
                                –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –æ—Ç—á–µ—Ç—ã
                            </button>
                            <button onclick="configureBiometric()" class="w-full bg-pink-500 text-white py-2 rounded-lg hover:bg-pink-600">
                                –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –±–∏–æ–º–µ—Ç—Ä–∏—é
                            </button>
                        </div>
                        <div>
                            <h3 class="font-medium mb-2">ERP</h3>
                            <button onclick="configureERP()" class="w-full bg-orange-500 text-white py-2 rounded-lg hover:bg-orange-600">
                                –ù–∞—Å—Ç—Ä–æ–∏—Ç—å ERP
                            </button>
                        </div>
                    </div>
                    <div class="mt-4 flex gap-2">
                        <button onclick="this.closest('.fixed').remove()" class="flex-1 px-4 py-2 border rounded-lg">
                            –ó–∞–∫—Ä—ã—Ç—å
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
        }
        
        // –û–±–Ω–æ–≤–∏—Ç—å –∫–Ω–æ–ø–∫—É –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
        function updateAuthButton() {
            const authBtn = document.getElementById('authBtn');
            const currentUser = authModule.getCurrentUser();
            
            if (currentUser) {
                authBtn.textContent = currentUser.name;
                authBtn.onclick = async function() {
                    await authModule.logout();
                    location.reload();
                };
            } else {
                authBtn.textContent = '–í—Ö–æ–¥';
                authBtn.onclick = showAuthModal;
            }
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è POS —Å–∏—Å—Ç–µ–º—ã
        async function initializePOSModules() {
            try {
                console.log('–ù–∞—á–∏–Ω–∞–µ–º –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é POS —Å–∏—Å—Ç–µ–º—ã...');
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –≤—Å–µ –º–æ–¥—É–ª–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω—ã
                if (!authModule) {
                    throw new Error('–ú–æ–¥—É–ª—å –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω');
                }
                
                // –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                const currentUser = authModule.getCurrentUser();
                if (!currentUser) {
                    throw new Error('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω');
                }
                
                console.log('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω:', currentUser.name);
                
                // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ç–µ—Ä–º–∏–Ω–∞–ª–∞
                if (acquiringModule && acquiringModule.initializeTerminal) {
                    console.log('–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ç–µ—Ä–º–∏–Ω–∞–ª–∞...');
                    try {
                        await acquiringModule.initializeTerminal();
                        console.log('–¢–µ—Ä–º–∏–Ω–∞–ª –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω —É—Å–ø–µ—à–Ω–æ');
                    } catch (error) {
                        console.warn('–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ —Ç–µ—Ä–º–∏–Ω–∞–ª–∞:', error);
                    }
                } else {
                    console.log('–ú–æ–¥—É–ª—å —ç–∫–≤–∞–π—Ä–∏–Ω–≥–∞ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω');
                }
                
                // –û—Ç–∫—Ä—ã—Ç–∏–µ —Å–º–µ–Ω—ã
                if (reportsModule && reportsModule.openShift) {
                    console.log('–û—Ç–∫—Ä—ã—Ç–∏–µ —Å–º–µ–Ω—ã...');
                    try {
                        await reportsModule.openShift(currentUser.id);
                        console.log('–°–º–µ–Ω–∞ –æ—Ç–∫—Ä—ã—Ç–∞ —É—Å–ø–µ—à–Ω–æ');
                    } catch (error) {
                        console.warn('–û—à–∏–±–∫–∞ –æ—Ç–∫—Ä—ã—Ç–∏—è —Å–º–µ–Ω—ã:', error);
                    }
                } else {
                    console.log('–ú–æ–¥—É–ª—å –æ—Ç—á–µ—Ç–Ω–æ—Å—Ç–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω');
                }
                
                // –ó–∞–ø—É—Å–∫ –æ—Ñ–ª–∞–π–Ω –º–æ–¥—É–ª—è
                if (offlineModule && offlineModule.startSession) {
                    console.log('–ó–∞–ø—É—Å–∫ –æ—Ñ–ª–∞–π–Ω –º–æ–¥—É–ª—è...');
                    try {
                        offlineModule.startSession();
                        console.log('–û—Ñ–ª–∞–π–Ω –º–æ–¥—É–ª—å –∑–∞–ø—É—â–µ–Ω —É—Å–ø–µ—à–Ω–æ');
                    } catch (error) {
                        console.warn('–û—à–∏–±–∫–∞ –∑–∞–ø—É—Å–∫–∞ –æ—Ñ–ª–∞–π–Ω –º–æ–¥—É–ª—è:', error);
                    }
                } else {
                    console.log('–û—Ñ–ª–∞–π–Ω –º–æ–¥—É–ª—å –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω');
                }
                
                // –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å ERP (—Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω)
                if (erpModule && erpModule.syncAll) {
                    const erpConfig = JSON.parse(localStorage.getItem('erpConfig') || '{}');
                    if (erpConfig.apiKey && erpConfig.apiUrl) {
                        console.log('–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å ERP...');
                        try {
                            await erpModule.syncAll();
                            console.log('ERP —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞');
                        } catch (error) {
                            console.warn('–û—à–∏–±–∫–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ ERP:', error);
                        }
                    } else {
                        console.log('ERP –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é');
                    }
                } else {
                    console.log('ERP –º–æ–¥—É–ª—å –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω');
                }
                
                console.log('POS —Å–∏—Å—Ç–µ–º–∞ —É—Å–ø–µ—à–Ω–æ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞');
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ POS:', error);
                console.error('–°—Ç–µ–∫ –æ—à–∏–±–∫–∏:', error.stack);
                alert('–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ POS —Å–∏—Å—Ç–µ–º—ã: ' + (error.message || error.toString()));
            }
        }
        
        // –§—É–Ω–∫—Ü–∏–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –º–æ–¥—É–ª–µ–π
        function configureFiscal() {
            alert('–ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ñ–∏—Å–∫–∞–ª–∏–∑–∞—Ü–∏–∏ - –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ');
        }
        
        function configureAcquiring() {
            alert('–ù–∞—Å—Ç—Ä–æ–π–∫–∞ —ç–∫–≤–∞–π—Ä–∏–Ω–≥–∞ - –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ');
        }
        
        function configureDelivery() {
            alert('–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–æ—Å—Ç–∞–≤–∫–∏ - –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ');
        }
        
        function configureERP() {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-white rounded-lg p-6 w-96">
                    <h2 class="text-xl font-bold mb-4">–ù–∞—Å—Ç—Ä–æ–π–∫–∞ ERP</h2>
                    <form id="erpConfigForm">
                        <div class="mb-4">
                            <label class="block text-sm font-medium mb-2">URL API</label>
                            <input type="url" id="erpApiUrl" class="w-full border rounded-lg px-3 py-2" placeholder="https://api.erp-system.com">
                        </div>
                        <div class="mb-4">
                            <label class="block text-sm font-medium mb-2">API Key</label>
                            <input type="text" id="erpApiKey" class="w-full border rounded-lg px-3 py-2" placeholder="–í–∞—à API –∫–ª—é—á">
                        </div>
                        <div class="mb-4">
                            <label class="block text-sm font-medium mb-2">–ò–Ω—Ç–µ—Ä–≤–∞–ª —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ (–º–∏–Ω—É—Ç—ã)</label>
                            <input type="number" id="erpSyncInterval" class="w-full border rounded-lg px-3 py-2" value="5" min="1">
                        </div>
                        <div class="flex gap-2">
                            <button type="submit" class="flex-1 bg-blue-500 text-white py-2 rounded-lg hover:bg-blue-600">
                                –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
                            </button>
                            <button type="button" onclick="this.closest('.fixed').remove()" class="px-4 py-2 border rounded-lg">
                                –û—Ç–º–µ–Ω–∞
                            </button>
                        </div>
                    </form>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // –ó–∞–≥—Ä—É–∑–∫–∞ —Ç–µ–∫—É—â–∏—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫
            const currentConfig = JSON.parse(localStorage.getItem('erpConfig') || '{}');
            document.getElementById('erpApiUrl').value = currentConfig.apiUrl || '';
            document.getElementById('erpApiKey').value = currentConfig.apiKey || '';
            document.getElementById('erpSyncInterval').value = (currentConfig.syncInterval || 300000) / 60000;
            
            document.getElementById('erpConfigForm').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const config = {
                    apiUrl: document.getElementById('erpApiUrl').value,
                    apiKey: document.getElementById('erpApiKey').value,
                    syncInterval: parseInt(document.getElementById('erpSyncInterval').value) * 60000
                };
                
                localStorage.setItem('erpConfig', JSON.stringify(config));
                
                if (erpModule) {
                    erpModule.configureERP(config);
                }
                
                modal.remove();
                alert('–ù–∞—Å—Ç—Ä–æ–π–∫–∏ ERP —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã');
            });
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–±—Ä–æ—Å–∞ –ø–∞—Ä–æ–ª–µ–π (–¥–ª—è –æ—Ç–ª–∞–¥–∫–∏)
        function resetPasswords() {
            const users = [
                {
                    id: 'admin_1',
                    username: 'admin',
                    password: btoa('admin123' + 'salt_dandy_2024'),
                    role: 'admin',
                    name: '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä',
                    email: 'admin@dandy.ru',
                    phone: '+7 (999) 123-45-67',
                    isActive: true,
                    createdAt: new Date().toISOString(),
                    lastLogin: null
                },
                {
                    id: 'cashier_1',
                    username: 'cashier1',
                    password: btoa('cashier123' + 'salt_dandy_2024'),
                    role: 'cashier',
                    name: '–ö–∞—Å—Å–∏—Ä 1',
                    email: 'cashier1@dandy.ru',
                    phone: '+7 (999) 123-45-68',
                    isActive: true,
                    createdAt: new Date().toISOString(),
                    lastLogin: null
                }
            ];
            
            localStorage.setItem('users', JSON.stringify(users));
            console.log('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å–±—Ä–æ—à–µ–Ω—ã:', users);
            
            // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ –º–æ–¥—É–ª–µ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
            if (authModule) {
                authModule.loadUsers();
            }
            
            alert('–ü–∞—Ä–æ–ª–∏ —Å–±—Ä–æ—à–µ–Ω—ã! –¢–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ –≤–æ–π—Ç–∏ —Å:\nadmin / admin123\ncashier1 / cashier123');
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏ –º–æ–¥—É–ª–µ–π
        function debugModules() {
            const status = {
                fiscalModule: !!fiscalModule,
                acquiringModule: !!acquiringModule,
                deliveryModule: !!deliveryModule,
                authModule: !!authModule,
                offlineModule: !!offlineModule,
                reportsModule: !!reportsModule,
                erpModule: !!erpModule,
                currentUser: authModule ? authModule.getCurrentUser() : null,
                localStorage: {
                    users: localStorage.getItem('users') ? '–µ—Å—Ç—å' : '–Ω–µ—Ç',
                    products: localStorage.getItem('products') ? '–µ—Å—Ç—å' : '–Ω–µ—Ç',
                    deliveryOrders: localStorage.getItem('deliveryOrders') ? '–µ—Å—Ç—å' : '–Ω–µ—Ç'
                }
            };
            
            console.log('–°—Ç–∞—Ç—É—Å –º–æ–¥—É–ª–µ–π:', status);
            alert('–°—Ç–∞—Ç—É—Å –º–æ–¥—É–ª–µ–π –≤ –∫–æ–Ω—Å–æ–ª–∏. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ F12');
            return status;
        }
        
        // –ü—Ä–æ—Å—Ç–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
        function testSystem() {
            console.log('=== –¢–ï–°–¢ –°–ò–°–¢–ï–ú–´ ===');
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –∫–ª–∞—Å—Å–æ–≤ –º–æ–¥—É–ª–µ–π
            const moduleClasses = {
                'FiscalModule': typeof FiscalModule !== 'undefined',
                'AcquiringModule': typeof AcquiringModule !== 'undefined',
                'DeliveryModule': typeof DeliveryModule !== 'undefined',
                'AuthModule': typeof AuthModule !== 'undefined',
                'OfflineModule': typeof OfflineModule !== 'undefined',
                'ReportsModule': typeof ReportsModule !== 'undefined',
                'ERPIntegrationModule': typeof ERPIntegrationModule !== 'undefined'
            };
            
            console.log('–î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –∫–ª–∞—Å—Å–æ–≤ –º–æ–¥—É–ª–µ–π:', moduleClasses);
            
            debugModules();
            
            if (authModule) {
                const user = authModule.getCurrentUser();
                console.log('–¢–µ–∫—É—â–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:', user);
            }
            
            console.log('=== –ö–û–ù–ï–¶ –¢–ï–°–¢–ê ===');
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–π –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
        function forceInit() {
            console.log('–ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è...');
            
            if (window.DEMO_DATA) {
                window.DEMO_DATA.initialize();
            }
            
            try {
                fiscalModule = new FiscalModule();
                acquiringModule = new AcquiringModule();
                deliveryModule = new DeliveryModule();
                authModule = new AuthModule();
                offlineModule = new OfflineModule();
                reportsModule = new ReportsModule();
                erpModule = new ERPIntegrationModule();
                
                // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –Ω–æ–≤—ã—Ö —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã—Ö –º–æ–¥—É–ª–µ–π
                realKKMModule = new RealKKMModule();
                realAcquiringModule = new RealAcquiringModule();
                enhancedOfflineModule = new EnhancedOfflineModule();
                enhancedModifiersModule = new EnhancedModifiersModule();
                compositeProductsModule = new CompositeProductsModule();
                aggregatorIntegrationsModule = new AggregatorIntegrationsModule();
                advancedReportingModule = new AdvancedReportingModule();
                biometricAuthModule = new BiometricAuthModule();
                
                console.log('–ú–æ–¥—É–ª–∏ –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω—ã');
                
                if (authModule && authModule.checkSession()) {
                    initializePOSModules();
                } else {
                    showAuthModal();
                }
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–π –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏:', error);
            }
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ö–µ—à–µ–π –ø–∞—Ä–æ–ª–µ–π
        function checkPasswordHashes() {
            console.log('=== –ü–†–û–í–ï–†–ö–ê –•–ï–®–ï–ô –ü–ê–†–û–õ–ï–ô ===');
            
            const testPassword = 'admin123';
            const expectedHash = btoa(testPassword + 'salt_dandy_2024');
            
            console.log('–¢–µ—Å—Ç–æ–≤—ã–π –ø–∞—Ä–æ–ª—å:', testPassword);
            console.log('–û–∂–∏–¥–∞–µ–º—ã–π —Ö–µ—à:', expectedHash);
            
            if (authModule) {
                const users = authModule.users;
                console.log('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –≤ —Å–∏—Å—Ç–µ–º–µ:');
                users.forEach(user => {
                    console.log(`- ${user.username}: ${user.password}`);
                    console.log(`  –°–æ–≤–ø–∞–¥–∞–µ—Ç —Å –æ–∂–∏–¥–∞–µ–º—ã–º: ${user.password === expectedHash}`);
                });
            }
            
            console.log('=== –ö–û–ù–ï–¶ –ü–†–û–í–ï–†–ö–ò ===');
        }

        // –§—É–Ω–∫—Ü–∏–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –Ω–æ–≤—ã—Ö –º–æ–¥—É–ª–µ–π
        function configureRealKKM() {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-white rounded-lg p-6 w-96 max-h-96 overflow-y-auto">
                    <h2 class="text-xl font-bold mb-4">–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Ä–µ–∞–ª—å–Ω–æ–π –ö–ö–ú</h2>
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium mb-1">–¢–∏–ø –ö–ö–ú</label>
                            <select id="kkmType" class="w-full border rounded-lg px-3 py-2">
                                <option value="kontur">–ö–æ–Ω—Ç—É—Ä.–ú–∞—Ä–∫–µ—Ç</option>
                                <option value="atol">–ê–¢–û–õ</option>
                                <option value="shtrih">–®—Ç—Ä–∏—Ö-–ú</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-1">–°–µ—Ä–∏–π–Ω—ã–π –Ω–æ–º–µ—Ä –§–ù</label>
                            <input type="text" id="fnSerial" class="w-full border rounded-lg px-3 py-2" placeholder="9999999999999999">
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-1">–û–§–î –æ–ø–µ—Ä–∞—Ç–æ—Ä</label>
                            <input type="text" id="ofdOperator" class="w-full border rounded-lg px-3 py-2" placeholder="–ö–æ–Ω—Ç—É—Ä.–û–§–î">
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-1">–ò–ù–ù</label>
                            <input type="text" id="inn" class="w-full border rounded-lg px-3 py-2" placeholder="1234567890">
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-1">–ù–∞–∑–≤–∞–Ω–∏–µ –∫–æ–º–ø–∞–Ω–∏–∏</label>
                            <input type="text" id="companyName" class="w-full border rounded-lg px-3 py-2" placeholder="–û–û–û –î–≠–ù–î–ò">
                        </div>
                        <div class="flex gap-2">
                            <button onclick="saveRealKKMSettings()" class="flex-1 bg-green-600 text-white py-2 rounded-lg hover:bg-green-700">
                                –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
                            </button>
                            <button onclick="this.closest('.fixed').remove()" class="flex-1 bg-gray-500 text-white py-2 rounded-lg hover:bg-gray-600">
                                –û—Ç–º–µ–Ω–∞
                            </button>
                        </div>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        function saveRealKKMSettings() {
            const settings = {
                kkmType: document.getElementById('kkmType').value,
                fnSerial: document.getElementById('fnSerial').value,
                ofdOperator: document.getElementById('ofdOperator').value,
                inn: document.getElementById('inn').value,
                companyName: document.getElementById('companyName').value
            };
            
            localStorage.setItem('kkmSettings', JSON.stringify(settings));
            const modal = document.querySelector('.fixed');
            modal.remove();
            alert('–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ö–ö–ú —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã');
        }

        function configureRealAcquiring() {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-white rounded-lg p-6 w-96 max-h-96 overflow-y-auto">
                    <h2 class="text-xl font-bold mb-4">–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Ä–µ–∞–ª—å–Ω–æ–≥–æ —ç–∫–≤–∞–π—Ä–∏–Ω–≥–∞</h2>
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium mb-1">–¢–∏–ø —Ç–µ—Ä–º–∏–Ω–∞–ª–∞</label>
                            <select id="terminalType" class="w-full border rounded-lg px-3 py-2">
                                <option value="sberbank">–°–±–µ—Ä–±–∞–Ω–∫</option>
                                <option value="tinkoff">–¢–∏–Ω—å–∫–æ—Ñ—Ñ</option>
                                <option value="alfa">–ê–ª—å—Ñ–∞-–ë–∞–Ω–∫</option>
                                <option value="ingenico">Ingenico</option>
                                <option value="pax">PAX</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-1">ID –º–µ—Ä—á–∞–Ω—Ç–∞</label>
                            <input type="text" id="merchantId" class="w-full border rounded-lg px-3 py-2" placeholder="123456789">
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-1">ID —Ç–µ—Ä–º–∏–Ω–∞–ª–∞</label>
                            <input type="text" id="terminalId" class="w-full border rounded-lg px-3 py-2" placeholder="001">
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-1">API –∫–ª—é—á</label>
                            <input type="password" id="apiKey" class="w-full border rounded-lg px-3 py-2" placeholder="API –∫–ª—é—á">
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-1">URL API</label>
                            <input type="text" id="apiUrl" class="w-full border rounded-lg px-3 py-2" placeholder="https://api.bank.ru/v1">
                        </div>
                        <div class="flex gap-2">
                            <button onclick="saveRealAcquiringSettings()" class="flex-1 bg-blue-600 text-white py-2 rounded-lg hover:bg-blue-700">
                                –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
                            </button>
                            <button onclick="this.closest('.fixed').remove()" class="flex-1 bg-gray-500 text-white py-2 rounded-lg hover:bg-gray-600">
                                –û—Ç–º–µ–Ω–∞
                            </button>
                        </div>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        function saveRealAcquiringSettings() {
            const settings = {
                terminalType: document.getElementById('terminalType').value,
                merchantId: document.getElementById('merchantId').value,
                terminalId: document.getElementById('terminalId').value,
                apiKey: document.getElementById('apiKey').value,
                apiUrl: document.getElementById('apiUrl').value
            };
            
            localStorage.setItem('acquiringSettings', JSON.stringify(settings));
            const modal = document.querySelector('.fixed');
            modal.remove();
            alert('–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —ç–∫–≤–∞–π—Ä–∏–Ω–≥–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã');
        }

        function configureModifiers() {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-white rounded-lg p-6 w-96 max-h-96 overflow-y-auto">
                    <h2 class="text-xl font-bold mb-4">–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –º–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä–æ–≤</h2>
                    <div class="space-y-4">
                        <div class="text-sm text-gray-600">
                            –ú–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã —Ç–æ–≤–∞—Ä–æ–≤ —É–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é. –í—ã –º–æ–∂–µ—Ç–µ:
                        </div>
                        <div class="space-y-2">
                            <button onclick="showModifierStats()" class="w-full bg-orange-500 text-white py-2 rounded-lg hover:bg-orange-600">
                                –ü–æ–∫–∞–∑–∞—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
                            </button>
                            <button onclick="exportModifiers()" class="w-full bg-green-500 text-white py-2 rounded-lg hover:bg-green-600">
                                –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –º–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã
                            </button>
                        </div>
                        <div class="flex gap-2">
                            <button onclick="this.closest('.fixed').remove()" class="flex-1 bg-gray-500 text-white py-2 rounded-lg hover:bg-gray-600">
                                –ó–∞–∫—Ä—ã—Ç—å
                            </button>
                        </div>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        function configureCompositeProducts() {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-white rounded-lg p-6 w-96 max-h-96 overflow-y-auto">
                    <h2 class="text-xl font-bold mb-4">–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–æ—Å—Ç–∞–≤–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤</h2>
                    <div class="space-y-4">
                        <div class="text-sm text-gray-600">
                            –°–æ—Å—Ç–∞–≤–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã (–∫–æ–º–±–æ) —É–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é. –í—ã –º–æ–∂–µ—Ç–µ:
                        </div>
                        <div class="space-y-2">
                            <button onclick="showCompositeStats()" class="w-full bg-indigo-500 text-white py-2 rounded-lg hover:bg-indigo-600">
                                –ü–æ–∫–∞–∑–∞—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
                            </button>
                            <button onclick="exportComposites()" class="w-full bg-green-500 text-white py-2 rounded-lg hover:bg-green-600">
                                –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å —Ç–æ–≤–∞—Ä—ã
                            </button>
                        </div>
                        <div class="flex gap-2">
                            <button onclick="this.closest('.fixed').remove()" class="flex-1 bg-gray-500 text-white py-2 rounded-lg hover:bg-gray-600">
                                –ó–∞–∫—Ä—ã—Ç—å
                            </button>
                        </div>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        function configureOfflineMode() {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-white rounded-lg p-6 w-96 max-h-96 overflow-y-auto">
                    <h2 class="text-xl font-bold mb-4">–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –æ—Ñ–ª–∞–π–Ω-—Ä–µ–∂–∏–º–∞</h2>
                    <div class="space-y-4">
                        <div class="text-sm text-gray-600">
                            –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π –æ—Ñ–ª–∞–π–Ω-—Ä–µ–∂–∏–º –∞–∫—Ç–∏–≤–µ–Ω. –°—Ç–∞—Ç—É—Å:
                        </div>
                        <div id="offlineStatus" class="p-3 bg-gray-100 rounded-lg text-sm">
                            –ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞—Ç—É—Å–∞...
                        </div>
                        <div class="space-y-2">
                            <button onclick="syncOfflineData()" class="w-full bg-green-500 text-white py-2 rounded-lg hover:bg-green-600">
                                –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ
                            </button>
                            <button onclick="clearOfflineData()" class="w-full bg-red-500 text-white py-2 rounded-lg hover:bg-red-600">
                                –û—á–∏—Å—Ç–∏—Ç—å –ª–æ–∫–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
                            </button>
                        </div>
                        <div class="flex gap-2">
                            <button onclick="this.closest('.fixed').remove()" class="flex-1 bg-gray-500 text-white py-2 rounded-lg hover:bg-gray-600">
                                –ó–∞–∫—Ä—ã—Ç—å
                            </button>
                        </div>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –æ—Ñ–ª–∞–π–Ω-—Ä–µ–∂–∏–º–∞
            updateOfflineStatus();
        }

        function updateOfflineStatus() {
            if (enhancedOfflineModule) {
                const status = enhancedOfflineModule.getStatus();
                const statusElement = document.getElementById('offlineStatus');
                if (statusElement) {
                    statusElement.innerHTML = `
                        <div><strong>–°—Ç–∞—Ç—É—Å —Å–µ—Ç–∏:</strong> ${status.isOnline ? '–û–Ω–ª–∞–π–Ω' : '–û—Ñ–ª–∞–π–Ω'}</div>
                        <div><strong>–û—á–µ—Ä–µ–¥—å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏:</strong> ${status.syncQueueLength} —ç–ª–µ–º–µ–Ω—Ç–æ–≤</div>
                        <div><strong>–õ–æ–∫–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:</strong></div>
                        <div class="ml-4">
                            <div>–ó–∞–∫–∞–∑—ã: ${status.localDataCount.orders}</div>
                            <div>–ü–ª–∞—Ç–µ–∂–∏: ${status.localDataCount.payments}</div>
                            <div>–ß–µ–∫–∏: ${status.localDataCount.receipts}</div>
                            <div>–¢–æ–≤–∞—Ä—ã: ${status.localDataCount.products}</div>
                            <div>–ö–∞—Ç–µ–≥–æ—Ä–∏–∏: ${status.localDataCount.categories}</div>
                        </div>
                    `;
                }
            }
        }

        function syncOfflineData() {
            if (enhancedOfflineModule) {
                enhancedOfflineModule.syncData();
                alert('–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∑–∞–ø—É—â–µ–Ω–∞');
                updateOfflineStatus();
            }
        }

        function clearOfflineData() {
            if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –æ—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ –ª–æ–∫–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ?')) {
                if (enhancedOfflineModule) {
                    enhancedOfflineModule.clearLocalData();
                    alert('–õ–æ–∫–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –æ—á–∏—â–µ–Ω—ã');
                    updateOfflineStatus();
                }
            }
        }

        function showModifierStats() {
            if (enhancedModifiersModule) {
                const stats = enhancedModifiersModule.getModifierStats();
                alert(`–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –º–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä–æ–≤:
–í—Å–µ–≥–æ –º–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä–æ–≤: ${stats.totalModifiers}
–í—Å–µ–≥–æ –≥—Ä—É–ø–ø: ${stats.totalGroups}
–°—Ä–µ–¥–Ω—è—è —Ü–µ–Ω–∞: ${stats.averagePrice.toFixed(2)}‚ÇΩ`);
            }
        }

        function showCompositeStats() {
            if (compositeProductsModule) {
                const stats = compositeProductsModule.getCompositeStats();
                alert(`–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–æ—Å—Ç–∞–≤–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤:
–í—Å–µ–≥–æ —Ç–æ–≤–∞—Ä–æ–≤: ${stats.totalProducts}
–í—Å–µ–≥–æ —à–∞–±–ª–æ–Ω–æ–≤: ${stats.totalTemplates}
–°—Ä–µ–¥–Ω—è—è —Ü–µ–Ω–∞: ${stats.averagePrice.toFixed(2)}‚ÇΩ
–°—Ä–µ–¥–Ω—è—è —Å–∫–∏–¥–∫–∞: ${(stats.averageDiscount * 100).toFixed(1)}%`);
            }
        }

        function exportModifiers() {
            if (enhancedModifiersModule) {
                const data = enhancedModifiersModule.exportModifiers();
                const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'modifiers.json';
                a.click();
                URL.revokeObjectURL(url);
                alert('–ú–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã');
            }
        }

        function exportComposites() {
            if (compositeProductsModule) {
                const data = compositeProductsModule.exportCompositeProducts();
                const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'composite-products.json';
                a.click();
                URL.revokeObjectURL(url);
                alert('–°–æ—Å—Ç–∞–≤–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã');
            }
        }

        // –§—É–Ω–∫—Ü–∏–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –Ω–æ–≤—ã—Ö –º–æ–¥—É–ª–µ–π
        function configureAggregators() {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-white rounded-lg p-6 w-96 max-h-96 overflow-y-auto">
                    <h2 class="text-xl font-bold mb-4">–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∞–≥—Ä–µ–≥–∞—Ç–æ—Ä–æ–≤</h2>
                    <div class="space-y-4">
                        <div class="text-sm text-gray-600">
                            –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å –∞–≥—Ä–µ–≥–∞—Ç–æ—Ä–∞–º–∏ –¥–æ—Å—Ç–∞–≤–∫–∏:
                        </div>
                        <div class="space-y-2">
                            <button onclick="showAggregatorStats()" class="w-full bg-purple-500 text-white py-2 rounded-lg hover:bg-purple-600">
                                –ü–æ–∫–∞–∑–∞—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
                            </button>
                            <button onclick="testAggregatorConnections()" class="w-full bg-blue-500 text-white py-2 rounded-lg hover:bg-blue-600">
                                –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
                            </button>
                            <button onclick="exportAggregatorSettings()" class="w-full bg-green-500 text-white py-2 rounded-lg hover:bg-green-600">
                                –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
                            </button>
                        </div>
                        <div class="flex gap-2">
                            <button onclick="this.closest('.fixed').remove()" class="flex-1 bg-gray-500 text-white py-2 rounded-lg hover:bg-gray-600">
                                –ó–∞–∫—Ä—ã—Ç—å
                            </button>
                        </div>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        function configureReporting() {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-white rounded-lg p-6 w-96 max-h-96 overflow-y-auto">
                    <h2 class="text-xl font-bold mb-4">–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –æ—Ç—á–µ—Ç–æ–≤</h2>
                    <div class="space-y-4">
                        <div class="text-sm text-gray-600">
                            –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –æ—Ç—á–µ—Ç–Ω–æ—Å—Ç—å –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∞:
                        </div>
                        <div class="space-y-2">
                            <button onclick="showReportStats()" class="w-full bg-teal-500 text-white py-2 rounded-lg hover:bg-teal-600">
                                –ü–æ–∫–∞–∑–∞—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
                            </button>
                            <button onclick="generateSampleReport()" class="w-full bg-blue-500 text-white py-2 rounded-lg hover:bg-blue-600">
                                –°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–π –æ—Ç—á–µ—Ç
                            </button>
                            <button onclick="exportReportTemplates()" class="w-full bg-green-500 text-white py-2 rounded-lg hover:bg-green-600">
                                –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å —à–∞–±–ª–æ–Ω—ã
                            </button>
                        </div>
                        <div class="flex gap-2">
                            <button onclick="this.closest('.fixed').remove()" class="flex-1 bg-gray-500 text-white py-2 rounded-lg hover:bg-gray-600">
                                –ó–∞–∫—Ä—ã—Ç—å
                            </button>
                        </div>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        function configureBiometric() {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-white rounded-lg p-6 w-96 max-h-96 overflow-y-auto">
                    <h2 class="text-xl font-bold mb-4">–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –±–∏–æ–º–µ—Ç—Ä–∏–∏</h2>
                    <div class="space-y-4">
                        <div id="biometricStatus" class="p-3 bg-gray-100 rounded-lg text-sm">
                            –ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞—Ç—É—Å–∞...
                        </div>
                        <div class="space-y-2">
                            <button onclick="testBiometricAuth()" class="w-full bg-pink-500 text-white py-2 rounded-lg hover:bg-pink-600">
                                –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –±–∏–æ–º–µ—Ç—Ä–∏—é
                            </button>
                            <button onclick="showBiometricUsers()" class="w-full bg-blue-500 text-white py-2 rounded-lg hover:bg-blue-600">
                                –ü–æ–∫–∞–∑–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
                            </button>
                            <button onclick="clearBiometricUsers()" class="w-full bg-red-500 text-white py-2 rounded-lg hover:bg-red-600">
                                –û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
                            </button>
                        </div>
                        <div class="flex gap-2">
                            <button onclick="this.closest('.fixed').remove()" class="flex-1 bg-gray-500 text-white py-2 rounded-lg hover:bg-gray-600">
                                –ó–∞–∫—Ä—ã—Ç—å
                            </button>
                        </div>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –±–∏–æ–º–µ—Ç—Ä–∏–∏
            updateBiometricStatus();
        }

        function updateBiometricStatus() {
            if (biometricAuthModule) {
                const status = biometricAuthModule.getBiometricStatus();
                const statusElement = document.getElementById('biometricStatus');
                if (statusElement) {
                    statusElement.innerHTML = `
                        <div><strong>–ü–æ–¥–¥–µ—Ä–∂–∫–∞:</strong> ${status.isSupported ? '–î–∞' : '–ù–µ—Ç'}</div>
                        <div><strong>–¢–∏–ø:</strong> ${status.biometricType || '–ù–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è'}</div>
                        <div><strong>–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:</strong> ${status.enrolledUsersCount}</div>
                        <div><strong>–î–æ—Å—Ç—É–ø–Ω—ã–µ —Ç–∏–ø—ã:</strong></div>
                        <div class="ml-4">${biometricAuthModule.getAvailableBiometricTypes().join('<br>')}</div>
                    `;
                }
            }
        }

        function showAggregatorStats() {
            if (aggregatorIntegrationsModule) {
                const stats = aggregatorIntegrationsModule.getAggregatorStats();
                alert(`–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∞–≥—Ä–µ–≥–∞—Ç–æ—Ä–æ–≤:
–í—Å–µ–≥–æ –∞–≥—Ä–µ–≥–∞—Ç–æ—Ä–æ–≤: ${stats.totalAggregators}
–ê–∫—Ç–∏–≤–Ω—ã—Ö: ${stats.activeAggregators}
–í—Å–µ–≥–æ –∑–∞–∫–∞–∑–æ–≤: ${stats.totalOrders}
–û–±—â–∞—è –∫–æ–º–∏—Å—Å–∏—è: ${stats.totalCommission.toFixed(2)}‚ÇΩ`);
            }
        }

        function showReportStats() {
            if (advancedReportingModule) {
                const stats = advancedReportingModule.getReportStats();
                alert(`–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ—Ç—á–µ—Ç–æ–≤:
–í—Å–µ–≥–æ –æ—Ç—á–µ—Ç–æ–≤: ${stats.totalReports}
–®–∞–±–ª–æ–Ω–æ–≤: ${stats.totalTemplates}
–ü–æ—Å–ª–µ–¥–Ω–∏–π –æ—Ç—á–µ—Ç: ${stats.lastGenerated ? new Date(stats.lastGenerated.generatedAt).toLocaleString() : '–ù–µ—Ç'}`);
            }
        }

        function showBiometricUsers() {
            if (biometricAuthModule) {
                const users = biometricAuthModule.getEnrolledUsers();
                if (users.length === 0) {
                    alert('–ù–µ—Ç –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –¥–ª—è –±–∏–æ–º–µ—Ç—Ä–∏—á–µ—Å–∫–æ–π –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏');
                } else {
                    const userList = users.map(user => 
                        `${user.userInfo.username} (${user.biometricType}) - ${new Date(user.enrolledAt).toLocaleDateString()}`
                    ).join('\n');
                    alert(`–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏:\n${userList}`);
                }
            }
        }

        function testAggregatorConnections() {
            if (aggregatorIntegrationsModule) {
                const aggregators = aggregatorIntegrationsModule.getAllAggregators();
                let results = '–†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:\n';
                
                aggregators.forEach(async (aggregator) => {
                    const result = await aggregatorIntegrationsModule.testAggregatorConnection(aggregator.id);
                    results += `${aggregator.name}: ${result.success ? 'OK' : '–û—à–∏–±–∫–∞'}\n`;
                });
                
                alert(results);
            }
        }

        function generateSampleReport() {
            if (advancedReportingModule) {
                const reportResult = advancedReportingModule.generateReport('sales_report', {
                    dateRange: {
                        startDate: new Date(Date.now() - 7 * 24 * 60 * 60 * 1000).toISOString(),
                        endDate: new Date().toISOString()
                    }
                });
                
                if (reportResult.success) {
                    alert(`–û—Ç—á–µ—Ç —Å–æ–∑–¥–∞–Ω —É—Å–ø–µ—à–Ω–æ!\nID: ${reportResult.report.id}\n–ó–∞–ø–∏—Å–µ–π: ${reportResult.report.data.length}`);
                } else {
                    alert('–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –æ—Ç—á–µ—Ç–∞: ' + reportResult.error);
                }
            }
        }

        function testBiometricAuth() {
            if (biometricAuthModule) {
                biometricAuthModule.testBiometricAuth().then(result => {
                    if (result.success) {
                        alert(`–¢–µ—Å—Ç —É—Å–ø–µ—à–µ–Ω!\n${result.message}\n–¢–∏–ø: ${result.biometricType}`);
                    } else {
                        alert('–û—à–∏–±–∫–∞ —Ç–µ—Å—Ç–∞: ' + result.error);
                    }
                });
            }
        }

        function clearBiometricUsers() {
            if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏–∑ –±–∏–æ–º–µ—Ç—Ä–∏—á–µ—Å–∫–æ–π –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏?')) {
                if (biometricAuthModule) {
                    const result = biometricAuthModule.clearAllEnrolledUsers();
                    if (result.success) {
                        alert(result.message);
                        updateBiometricStatus();
                    } else {
                        alert('–û—à–∏–±–∫–∞: ' + result.error);
                    }
                }
            }
        }

        function exportAggregatorSettings() {
            if (aggregatorIntegrationsModule) {
                const data = aggregatorIntegrationsModule.exportAggregatorSettings();
                const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'aggregator-settings.json';
                a.click();
                URL.revokeObjectURL(url);
                alert('–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∞–≥—Ä–µ–≥–∞—Ç–æ—Ä–æ–≤ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã');
            }
        }

        function exportReportTemplates() {
            if (advancedReportingModule) {
                const templates = advancedReportingModule.getAllReportTemplates();
                const blob = new Blob([JSON.stringify(templates, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'report-templates.json';
                a.click();
                URL.revokeObjectURL(url);
                alert('–®–∞–±–ª–æ–Ω—ã –æ—Ç—á–µ—Ç–æ–≤ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã');
            }
        }

        // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞–º–∏
        let allOrders = [];
        let currentFilter = 'all';

        // –ó–∞–≥—Ä—É–∑–∫–∞ –∑–∞–∫–∞–∑–æ–≤
        async function loadOrders() {
            try {
                console.log('–ó–∞–≥—Ä—É–∂–∞–µ–º –∑–∞–∫–∞–∑—ã —Å API...');
                const response = await fetch('http://localhost:3000/api/orders');
                console.log('–û—Ç–≤–µ—Ç —Å–µ—Ä–≤–µ—Ä–∞:', response.status, response.statusText);
                
                if (response.ok) {
                    const result = await response.json();
                    console.log('–ó–∞–∫–∞–∑—ã –∑–∞–≥—Ä—É–∂–µ–Ω—ã:', result);
                    
                    // API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç {success: true, data: [...]}
                    allOrders = result.data || result || [];
                    console.log('–û–±—Ä–∞–±–æ—Ç–∞–Ω–æ –∑–∞–∫–∞–∑–æ–≤:', allOrders.length);
                    displayOrders();
                } else {
                    console.error('Failed to load orders:', response.status, response.statusText);
                    const errorText = await response.text();
                    console.error('Error response:', errorText);
                }
            } catch (error) {
                console.error('Error loading orders:', error);
                console.error('Error details:', error.message);
            }
        }

        // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∑–∞–∫–∞–∑–æ–≤
        function displayOrders() {
            const ordersList = document.getElementById('ordersList');
            const noOrders = document.getElementById('noOrders');
            
            let filteredOrders = allOrders;
            if (currentFilter !== 'all') {
                filteredOrders = allOrders.filter(order => order.status === currentFilter);
            }

            if (filteredOrders.length === 0) {
                ordersList.style.display = 'none';
                noOrders.style.display = 'block';
                return;
            }

            ordersList.style.display = 'block';
            noOrders.style.display = 'none';

            ordersList.innerHTML = filteredOrders.map(order => `
                <div class="border rounded-lg p-3 bg-gray-50">
                    <div class="flex justify-between items-start mb-2">
                        <div>
                            <div class="font-semibold text-sm">#${order.id}</div>
                            <div class="text-xs text-gray-600">${order.customer_name} ‚Ä¢ ${order.customer_phone}</div>
                        </div>
                        <div class="text-right">
                            <div class="text-sm font-medium">${order.total} ‚ÇΩ</div>
                            <div class="text-xs text-gray-500">${getStatusText(order.status)}</div>
                        </div>
                    </div>
                    
                    <div class="text-xs text-gray-600 mb-2">
                        ${order.delivery_type === 'delivery' ? 'üöö –î–æ—Å—Ç–∞–≤–∫–∞' : 'üè™ –°–∞–º–æ–≤—ã–≤–æ–∑'}
                        ${order.address ? ` ‚Ä¢ ${order.address}` : ''}
                    </div>
                    
                    <!-- –¢–æ–≤–∞—Ä—ã –≤ –∑–∞–∫–∞–∑–µ -->
                    <div class="mb-3">
                        <div class="text-xs font-medium text-gray-700 mb-1">–¢–æ–≤–∞—Ä—ã:</div>
                        <div class="space-y-1">
                            ${order.items && order.items.length > 0 ? order.items.map(item => `
                                <div class="flex justify-between items-center text-xs bg-white rounded px-2 py-1">
                                    <div class="flex-1">
                                        <span class="font-medium">${item.product_name}</span>
                                        ${item.extras ? `<span class="text-gray-500"> (${JSON.parse(item.extras).join(', ')})</span>` : ''}
                                    </div>
                                    <div class="text-gray-600">
                                        ${item.quantity} —à—Ç √ó ${item.product_price} ‚ÇΩ = ${item.total} ‚ÇΩ
                                    </div>
                                </div>
                            `).join('') : '<div class="text-xs text-gray-500">–¢–æ–≤–∞—Ä—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</div>'}
                        </div>
                    </div>
                    
                    <!-- –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –∫ –∑–∞–∫–∞–∑—É -->
                    ${order.order_comment ? `
                        <div class="mb-2">
                            <div class="text-xs font-medium text-gray-700 mb-1">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π:</div>
                            <div class="text-xs text-gray-600 bg-yellow-50 rounded px-2 py-1">${order.order_comment}</div>
                        </div>
                    ` : ''}
                    
                    <div class="flex flex-wrap gap-1">
                        <button class="px-2 py-1 bg-gray-500 text-white rounded text-xs hover:bg-gray-600" onclick="showOrderDetails('${order.id}')">
                            üìã –ü–æ–¥—Ä–æ–±–Ω–µ–µ
                        </button>
                        ${getStatusButtons(order.status, order.id).map(btn => btn).join('')}
                    </div>
                </div>
            `).join('');
        }

        // –ü–æ–ª—É—á–µ–Ω–∏–µ –∫–Ω–æ–ø–æ–∫ –¥–ª—è —Å—Ç–∞—Ç—É—Å–∞
        function getStatusButtons(status, orderId) {
            const buttons = [];
            
            switch (status) {
                case 'accepted':
                    buttons.push(`<button class="px-2 py-1 bg-orange-500 text-white rounded text-xs hover:bg-orange-600" onclick="updateOrderStatus('${orderId}', 'preparing')">–ì–æ—Ç–æ–≤–∏—Ç—å</button>`);
                    buttons.push(`<button class="px-2 py-1 bg-red-500 text-white rounded text-xs hover:bg-red-600" onclick="updateOrderStatus('${orderId}', 'cancelled')">–û—Ç–º–µ–Ω–∏—Ç—å</button>`);
                    break;
                case 'preparing':
                    buttons.push(`<button class="px-2 py-1 bg-green-500 text-white rounded text-xs hover:bg-green-600" onclick="updateOrderStatus('${orderId}', 'ready')">–ì–æ—Ç–æ–≤</button>`);
                    break;
                case 'ready':
                    if (allOrders.find(o => o.id === orderId)?.delivery_type === 'delivery') {
                        buttons.push(`<button class="px-2 py-1 bg-blue-500 text-white rounded text-xs hover:bg-blue-600" onclick="updateOrderStatus('${orderId}', 'with_courier')">–ö—É—Ä—å–µ—Ä—É</button>`);
                    } else {
                        buttons.push(`<button class="px-2 py-1 bg-green-600 text-white rounded text-xs hover:bg-green-700" onclick="updateOrderStatus('${orderId}', 'delivered')">–í—ã–¥–∞–Ω</button>`);
                    }
                    break;
                case 'with_courier':
                    buttons.push(`<button class="px-2 py-1 bg-blue-600 text-white rounded text-xs hover:bg-blue-700" onclick="updateOrderStatus('${orderId}', 'in_transit')">–í –ø—É—Ç–∏</button>`);
                    break;
                case 'in_transit':
                    buttons.push(`<button class="px-2 py-1 bg-green-600 text-white rounded text-xs hover:bg-green-700" onclick="updateOrderStatus('${orderId}', 'delivered')">–î–æ—Å—Ç–∞–≤–ª–µ–Ω</button>`);
                    break;
                case 'delivered':
                    buttons.push(`<button class="px-2 py-1 bg-gray-400 text-white rounded text-xs cursor-not-allowed" disabled>–ó–∞–≤–µ—Ä—à–µ–Ω</button>`);
                    break;
                case 'cancelled':
                    buttons.push(`<button class="px-2 py-1 bg-gray-400 text-white rounded text-xs cursor-not-allowed" disabled>–û—Ç–º–µ–Ω–µ–Ω</button>`);
                    break;
            }
            
            return buttons;
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –∑–∞–∫–∞–∑–∞
        async function updateOrderStatus(orderId, newStatus) {
            try {
                console.log(`–û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å –∑–∞–∫–∞–∑–∞ ${orderId} –Ω–∞ ${newStatus}`);
                const response = await fetch(`http://localhost:3000/api/orders/${orderId}/status`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ status: newStatus })
                });

                console.log('–û—Ç–≤–µ—Ç —Å–µ—Ä–≤–µ—Ä–∞ –Ω–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞:', response.status, response.statusText);

                if (response.ok) {
                    console.log(`–°—Ç–∞—Ç—É—Å –∑–∞–∫–∞–∑–∞ ${orderId} –æ–±–Ω–æ–≤–ª–µ–Ω –Ω–∞ ${newStatus}`);
                    // –û–±–Ω–æ–≤–ª—è–µ–º –ª–æ–∫–∞–ª—å–Ω—ã–π –º–∞—Å—Å–∏–≤ –∑–∞–∫–∞–∑–æ–≤
                    const orderIndex = allOrders.findIndex(o => o.id === orderId);
                    if (orderIndex !== -1) {
                        allOrders[orderIndex].status = newStatus;
                        allOrders[orderIndex].updated_at = new Date().toISOString();
                    }
                    
                    displayOrders();
                } else {
                    console.error('Failed to update order status:', response.status, response.statusText);
                    const errorText = await response.text();
                    console.error('Error response:', errorText);
                    alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Å—Ç–∞—Ç—É—Å–∞ –∑–∞–∫–∞–∑–∞: ' + response.status);
                }
            } catch (error) {
                console.error('Error updating order status:', error);
                console.error('Error details:', error.message);
                alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Å—Ç–∞—Ç—É—Å–∞ –∑–∞–∫–∞–∑–∞: ' + error.message);
            }
        }

        // –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –∑–∞–∫–∞–∑–æ–≤
        function filterOrders(status) {
            currentFilter = status;
            displayOrders();
        }

        // –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ —Å—Ç–∞—Ç—É—Å–∞
        function getStatusText(status) {
            const statusMap = {
                'pending': '–ü—Ä–∏–Ω—è—Ç',
                'accepted': '–ü—Ä–∏–Ω—è—Ç',
                'preparing': '–ì–æ—Ç–æ–≤–∏—Ç—Å—è',
                'ready': '–ì–æ—Ç–æ–≤',
                'with_courier': '–£ –∫—É—Ä—å–µ—Ä–∞',
                'in_transit': '–í –ø—É—Ç–∏',
                'delivered': '–î–æ—Å—Ç–∞–≤–ª–µ–Ω',
                'cancelled': '–û—Ç–º–µ–Ω–µ–Ω'
            };
            return statusMap[status] || status;
        }

        // –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ —Å–ø–æ—Å–æ–±–∞ –æ–ø–ª–∞—Ç—ã
        function getPaymentMethodText(method) {
            const methodMap = {
                'cash': 'üíµ –ù–∞–ª–∏—á–Ω—ã–µ',
                'card': 'üí≥ –ö–∞—Ä—Ç–∞',
                'online': 'üåê –û–Ω–ª–∞–π–Ω',
                'sbp': 'üì± –°–ë–ü'
            };
            return methodMap[method] || method || '–ù–µ —É–∫–∞–∑–∞–Ω';
        }

        // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞—Ç—ã
        function formatDate(date) {
            if (!date) return '–ù–µ —É–∫–∞–∑–∞–Ω–æ';
            try {
                const d = new Date(date);
                if (isNaN(d.getTime())) return '–ù–µ —É–∫–∞–∑–∞–Ω–æ';
                return d.toLocaleString('ru-RU', {
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                });
            } catch (e) {
                return '–ù–µ —É–∫–∞–∑–∞–Ω–æ';
            }
        }

        // –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥
        setInterval(loadOrders, 30000);

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∑–∞–∫–∞–∑–æ–≤ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        setTimeout(loadOrders, 2000);

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–∫–∞–∑–∞ –¥–µ—Ç–∞–ª–µ–π –∑–∞–∫–∞–∑–∞
        async function showOrderDetails(orderId) {
            try {
                const response = await fetch(`http://localhost:3000/api/orders/${orderId}`);
                if (response.ok) {
                    const result = await response.json();
                    // API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç { success: true, data: {...} }
                    const order = result.data || result;
                    console.log('Order details:', order);
                    displayOrderDetails(order);
                } else {
                    console.error('Failed to load order details');
                }
            } catch (error) {
                console.error('Error loading order details:', error);
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –¥–µ—Ç–∞–ª–µ–π –∑–∞–∫–∞–∑–∞
        function displayOrderDetails(order) {
            const modal = document.getElementById('orderDetailsModal');
            const content = document.getElementById('orderDetailsContent');
            
            content.innerHTML = `
                <div class="space-y-4">
                    <!-- –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
                    <div class="bg-gray-50 rounded-lg p-4">
                        <h4 class="font-semibold mb-2">–û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h4>
                        <div class="grid grid-cols-2 gap-2 text-sm">
                            <div><strong>–ù–æ–º–µ—Ä –∑–∞–∫–∞–∑–∞:</strong> #${order.id}</div>
                            <div><strong>–°—Ç–∞—Ç—É—Å:</strong> ${getStatusText(order.status)}</div>
                            <div><strong>–ö–ª–∏–µ–Ω—Ç:</strong> ${order.customerName || order.customer_name || '–ù–µ —É–∫–∞–∑–∞–Ω'}</div>
                            <div><strong>–¢–µ–ª–µ—Ñ–æ–Ω:</strong> ${order.customerPhone || order.customer_phone || '–ù–µ —É–∫–∞–∑–∞–Ω'}</div>
                            <div><strong>Email:</strong> ${order.customerEmail || order.customer_email || '–ù–µ —É–∫–∞–∑–∞–Ω'}</div>
                            <div><strong>–¢–∏–ø –¥–æ—Å—Ç–∞–≤–∫–∏:</strong> ${(order.deliveryType || order.delivery_type) === 'delivery' ? 'üöö –î–æ—Å—Ç–∞–≤–∫–∞' : 'üè™ –°–∞–º–æ–≤—ã–≤–æ–∑'}</div>
                            <div><strong>–°–ø–æ—Å–æ–± –æ–ø–ª–∞—Ç—ã:</strong> ${getPaymentMethodText(order.paymentMethod || order.payment_method)}</div>
                            <div><strong>–°—É–º–º–∞:</strong> ${order.total} ‚ÇΩ</div>
                        </div>
                    </div>

                    <!-- –ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏ -->
                    ${(order.deliveryType || order.delivery_type) === 'delivery' ? `
                        <div class="bg-blue-50 rounded-lg p-4">
                            <h4 class="font-semibold mb-2">–ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏</h4>
                            <div class="text-sm">
                                <div><strong>–ê–¥—Ä–µ—Å:</strong> ${order.address || order.deliveryAddress || '–ù–µ —É–∫–∞–∑–∞–Ω'}</div>
                                ${order.apartment ? `<div><strong>–ö–≤–∞—Ä—Ç–∏—Ä–∞:</strong> ${order.apartment}</div>` : ''}
                                ${(order.address_comment || order.addressComment) ? `<div><strong>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π:</strong> ${order.address_comment || order.addressComment}</div>` : ''}
                            </div>
                        </div>
                    ` : ''}

                    <!-- –¢–æ–≤–∞—Ä—ã –≤ –∑–∞–∫–∞–∑–µ -->
                    <div class="bg-green-50 rounded-lg p-4">
                        <h4 class="font-semibold mb-2">–¢–æ–≤–∞—Ä—ã –≤ –∑–∞–∫–∞–∑–µ</h4>
                        <div class="space-y-2">
                            ${order.items && order.items.length > 0 ? order.items.map(item => {
                                const itemName = item.name || item.product_name || item.productName || '–¢–æ–≤–∞—Ä';
                                const itemPrice = item.price || item.product_price || item.productPrice || 0;
                                const itemQty = item.quantity || item.qty || 1;
                                const itemTotal = item.total || (itemPrice * itemQty);
                                const itemExtras = item.extras || item.modifiers || null;
                                
                                return `
                                <div class="bg-white rounded p-3 border">
                                    <div class="flex justify-between items-start">
                                        <div class="flex-1">
                                            <div class="font-medium">${itemName}</div>
                                            ${itemExtras ? `<div class="text-sm text-gray-600">–î–æ–ø–æ–ª–Ω–µ–Ω–∏—è: ${typeof itemExtras === 'string' ? JSON.parse(itemExtras).join(', ') : itemExtras.join(', ')}</div>` : ''}
                                        </div>
                                        <div class="text-right text-sm">
                                            <div>${itemQty} —à—Ç √ó ${itemPrice} ‚ÇΩ</div>
                                            <div class="font-semibold">= ${itemTotal} ‚ÇΩ</div>
                                        </div>
                                    </div>
                                </div>
                            `}).join('') : '<div class="text-gray-500">–¢–æ–≤–∞—Ä—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</div>'}
                        </div>
                    </div>

                    <!-- –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –∫ –∑–∞–∫–∞–∑—É -->
                    ${order.order_comment ? `
                        <div class="bg-yellow-50 rounded-lg p-4">
                            <h4 class="font-semibold mb-2">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –∫ –∑–∞–∫–∞–∑—É</h4>
                            <div class="text-sm">${order.order_comment}</div>
                        </div>
                    ` : ''}

                    <!-- –í—Ä–µ–º—è –∑–∞–∫–∞–∑–∞ -->
                    <div class="bg-gray-50 rounded-lg p-4">
                        <h4 class="font-semibold mb-2">–í—Ä–µ–º—è –∑–∞–∫–∞–∑–∞</h4>
                        <div class="text-sm">
                            <div><strong>–°–æ–∑–¥–∞–Ω:</strong> ${formatDate(order.createdAt || order.created_at)}</div>
                            <div><strong>–û–±–Ω–æ–≤–ª–µ–Ω:</strong> ${formatDate(order.updatedAt || order.updated_at)}</div>
                        </div>
                    </div>

                    <!-- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–æ–º –∑–∞–∫–∞–∑–∞ -->
                    <div class="bg-gradient-to-r from-purple-50 to-indigo-50 rounded-lg p-4 border-2 border-purple-200">
                        <h4 class="font-semibold mb-3 text-purple-800">üéØ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–æ–º –∑–∞–∫–∞–∑–∞</h4>
                        <div class="grid grid-cols-3 gap-2">
                            <button onclick="updateOrderStatus('${order.id}', 'pending')" 
                                    class="px-3 py-2 text-sm rounded-lg font-medium transition-all ${order.status === 'pending' ? 'bg-gray-600 text-white' : 'bg-white text-gray-700 hover:bg-gray-100'} border">
                                üìã –ü—Ä–∏–Ω—è—Ç
                            </button>
                            <button onclick="updateOrderStatus('${order.id}', 'preparing')" 
                                    class="px-3 py-2 text-sm rounded-lg font-medium transition-all ${order.status === 'preparing' ? 'bg-orange-600 text-white' : 'bg-white text-orange-700 hover:bg-orange-50'} border">
                                üë®‚Äçüç≥ –ì–æ—Ç–æ–≤–∏—Ç—Å—è
                            </button>
                            <button onclick="updateOrderStatus('${order.id}', 'ready')" 
                                    class="px-3 py-2 text-sm rounded-lg font-medium transition-all ${order.status === 'ready' ? 'bg-blue-600 text-white' : 'bg-white text-blue-700 hover:bg-blue-50'} border">
                                üì¶ –ì–æ—Ç–æ–≤
                            </button>
                            <button onclick="updateOrderStatus('${order.id}', 'with_courier')" 
                                    class="px-3 py-2 text-sm rounded-lg font-medium transition-all ${order.status === 'with_courier' ? 'bg-indigo-600 text-white' : 'bg-white text-indigo-700 hover:bg-indigo-50'} border">
                                üöö –£ –∫—É—Ä—å–µ—Ä–∞
                            </button>
                            <button onclick="updateOrderStatus('${order.id}', 'in_transit')" 
                                    class="px-3 py-2 text-sm rounded-lg font-medium transition-all ${order.status === 'in_transit' ? 'bg-purple-600 text-white' : 'bg-white text-purple-700 hover:bg-purple-50'} border">
                                üõµ –í –ø—É—Ç–∏
                            </button>
                            <button onclick="updateOrderStatus('${order.id}', 'delivered')" 
                                    class="px-3 py-2 text-sm rounded-lg font-medium transition-all ${order.status === 'delivered' ? 'bg-green-600 text-white' : 'bg-white text-green-700 hover:bg-green-50'} border">
                                ‚úÖ –î–æ—Å—Ç–∞–≤–ª–µ–Ω
                            </button>
                        </div>
                        <div class="mt-3 text-xs text-purple-600 bg-white rounded p-2">
                            üí° –°–æ–≤–µ—Ç: –ù–∞–∂–º–∏—Ç–µ –Ω–∞ –∫–Ω–æ–ø–∫—É, —á—Ç–æ–±—ã –∏–∑–º–µ–Ω–∏—Ç—å —Å—Ç–∞—Ç—É—Å –∑–∞–∫–∞–∑–∞. –ö–ª–∏–µ–Ω—Ç —É–≤–∏–¥–∏—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –Ω–∞ —Å–≤–æ–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è.
                        </div>
                    </div>
                </div>
            `;
            
            modal.classList.remove('hidden');
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–∫—Ä—ã—Ç–∏—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
        function closeOrderDetails() {
            document.getElementById('orderDetailsModal').classList.add('hidden');
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞ –∑–∞–∫–∞–∑–∞
        async function updateOrderStatus(orderId, newStatus) {
            try {
                const response = await fetch(`http://localhost:3000/api/orders/${orderId}/status`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ status: newStatus })
                });

                if (response.ok) {
                    console.log('Order status updated:', newStatus);
                    
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
                    showNotification('‚úÖ –°—Ç–∞—Ç—É—Å –∑–∞–∫–∞–∑–∞ –æ–±–Ω–æ–≤–ª–µ–Ω!', 'success');
                    
                    // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º –¥–µ—Ç–∞–ª–∏ –∑–∞–∫–∞–∑–∞
                    setTimeout(() => {
                        closeOrderDetails();
                        showOrderDetails(orderId);
                    }, 500);
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ –∑–∞–∫–∞–∑–æ–≤
                    loadOrders();
                } else {
                    showNotification('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Å—Ç–∞—Ç—É—Å–∞', 'error');
                }
            } catch (error) {
                console.error('Error updating order status:', error);
                showNotification('‚ùå –û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º', 'error');
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–∫–∞–∑–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `fixed top-4 right-4 z-50 px-6 py-3 rounded-lg shadow-lg text-white font-medium transition-all transform translate-x-0 ${
                type === 'success' ? 'bg-green-500' : 
                type === 'error' ? 'bg-red-500' : 
                'bg-blue-500'
            }`;
            notification.textContent = message;
            notification.style.animation = 'slideInRight 0.3s ease-out';
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.animation = 'slideOutRight 0.3s ease-in';
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }

        // –î–æ–±–∞–≤–ª—è–µ–º CSS –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–∏
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideInRight {
                from {
                    transform: translateX(400px);
                    opacity: 0;
                }
                to {
                    transform: translateX(0);
                    opacity: 1;
                }
            }
            @keyframes slideOutRight {
                from {
                    transform: translateX(0);
                    opacity: 1;
                }
                to {
                    transform: translateX(400px);
                    opacity: 0;
                }
            }
        `;
        document.head.appendChild(style);
    </script>

    <!-- API Helper -->
    <script src="js/api.js"></script>
</body>
</html>
